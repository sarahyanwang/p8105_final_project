---
title: "frequency_part"
authors: Yuanyuan Zeng
date: "11/21/2021"
output: html_document
---

```{r setup, include=FALSE}

library(tidyverse)
library(httr)
library(lubridate)
library(plotly)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

A. Number

1ï¼‰Frequency of tickets in five boroughs (Manhattan, Kings, The Bronx, State Island, Queens)
```{r}
violation = read_csv("./Open_Parking_and_Camera_Violations.csv") %>% 
  janitor::clean_names() %>%
  rename(borough = county) %>%  # rename county to borough
  mutate(
    borough = case_when(
      borough %in% c("BK","K", "Kings") ~ "Brooklyn",
      borough %in% c("BX", "Bronx") ~ "Bronx",
      borough %in% c("Q", "QN", "Qns") ~ "Queens",
      borough %in% c("ST", "R", "Rich", "RICH") ~ "State Island",
      borough %in% c("NY", "MN") ~ "Manhattan"),
    issue_date = mdy(issue_date),
    weekday = weekdays(issue_date),
    )  %>%  # make the borough the same 
  filter(borough != "A",                  # get rid of "A"
         weekday != "NA") %>%   # remove data that cannot turn into weekday
  separate(issue_date, into = c("year", "month", "day"), sep = "-")  # separate date into year, month, day

# another potential cleaning 1)select the variables we needed 2)convert the mon into character ?

violation %>% 
  count(borough) %>% 
  mutate(
    borough = fct_reorder(borough, n)) %>% 
  plot_ly(x = ~borough, y = ~n, color = ~borough, type = "bar", colors = "viridis") %>% 
  layout(title = "Frequency of Tickets in Boroughs",
         xaxis = list(title = "Borough"),
         yaxis = list(title = "Number of Tickets"))
```

Frequency of violation type in each borough.

```{r}
violation %>% 
  count(borough, violation) %>% 
  mutate(
      violation = fct_reorder(violation, n)
  ) %>% 
  plot_ly(x = ~violation, y = ~n, color = ~violation, type = "bar", facet_col = ~borough) %>% 
  layout(title = "Frequency of Violation Type",
         xaxis = list(title = "Violation Type"),
         yaxis = list(title = "Number of Tickets"))

violation_type = violation %>% 
  count(borough, violation) %>% 
  mutate(
    violation = fct_reorder(violation, n)
  ) %>% filter(borough == "Manhattan") %>% arrange(desc(n)) %>% head(10) %>% 
  ggplot(aes(x = violation, y = n, fill = violation)) + 
  geom_bar(stat = "identity") + 
  labs(
    title = "Frequency of Violation Type", 
    xlab = "Violation Type", 
    ylab = "Number of tickets") +
  theme(
    axis.text.x = element_text(angle = 90, vjust = .5, hjust = 1),
    legend.position = "right",
    legend.text = element_text(size = 8)
  )

ggplotly(violation_type)

```


