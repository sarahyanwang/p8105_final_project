---
title: "fines"
author: "Waveley Qiu (wq2162)"
date: "2021-12-03"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

source("code/data_cleaning.R")
source("code/formatting.R")
```

## Mean Fine Amount Across Boroughs

First, let us compute the average fine amounts across the different boroughs:
```{r}
violation %>%
  group_by(borough) %>%
  summarise(
    avg_fine = mean(fine_amount)
  )
```

We observe that the average fine amount is highest in Manhattan and lowest in Staten Island.

```{r}
violation %>% group_by(borough) %>% 
  ggplot(aes(x = fine_amount, fill = borough)) + 
  geom_boxplot(alpha = 0.3) +
  labs(
    x = "Fine Amount",
    fill = "Borough",
    title = "Fine Amount Across Boroughs"
  )
```

To see if fine amounts do differ significantly across boroughs, we will conduct a simple one-way ANOVA on these two variables.

```{r}
violation_reg <- lm(fine_amount~borough, data = violation)
anova(violation_reg)
```

There appear to be differences between fine amounts and at least 2 boroughs. 

## Which borough tends to pay the most in excess fees?

Now, we will investigate tendencies in amounts paid in excess of the baseline fine amount.

```{r}
violation %>%
  select(borough, contains("amount")) %>%
  mutate(
    net_total_amount = fine_amount + penalty_amount + interest_amount - reduction_amount,
    excess_amount = penalty_amount + interest_amount - reduction_amount
  ) %>%
  group_by(borough) %>%
  summarise(
    avg_excess_amount = mean(excess_amount),
    avg_net_total_amount = mean(net_total_amount),
    avg_total_amount = mean(fine_amount)
  )
```

It seems that parking violation fine adjustments are typically reduced, not increased, if the fine is adjusted.

```{r}
violation %>%
  select(borough, contains("amount")) %>%
  mutate(
    excess_amount = penalty_amount + interest_amount - reduction_amount
  ) %>%
  filter(excess_amount !=  0) %>%
  
  ggplot(aes(x = excess_amount, fill = borough)) +
  geom_boxplot(alpha = 0.3) +
  labs(
    x = "Fine Adjustment Amount",
    fill = "Borough",
    title = "Fine Adjustments by Borough"
  )
```































